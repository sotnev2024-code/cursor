# Функциональность модуля клиентов

## Реализованные функции

### 1. База данных

#### Новые поля в модели Client:
- `telegram_id` (VARCHAR(100), unique, nullable) - ID пользователя в Telegram для входа через мини-приложение
- `source` (VARCHAR(100)) - Источник клиента:
  - `telegram` - Telegram (мини-приложение)
  - `website` - Сайт
  - `phone` - Телефонный звонок
  - `walk_in` - Пришел сам
  - `referral` - Рекомендация
  - `social_media` - Социальные сети
  - `other` - Другое
- `notes` (TEXT) - Комментарии/заметки о клиенте

### 2. Backend (routes/clients.py)

#### Новые/обновленные endpoints:
- `GET /api/clients` - Получить всех клиентов (с поиском)
- `GET /api/clients/:id` - Получить клиента по ID (с записями)
- `POST /api/clients` - Создать нового клиента
- `PUT /api/clients/:id` - Обновить клиента
- `DELETE /api/clients/:id` - Удалить клиента
- `GET /api/clients/:id/bookings` - Получить историю записей клиента

### 3. Frontend

#### Модальное окно (js/modals/clientModal.js):
- Полная форма добавления/редактирования клиента
- Поля:
  - ФИО (обязательное)
  - Телефон
  - Email
  - Telegram ID
  - Дата рождения
  - Источник (обязательное, выпадающий список)
  - Комментарий/заметки
  - Фото (загрузка и предпросмотр)

#### Модуль клиентов (js/modules/clients.js):
- Добавление клиента (`saveClient()`)
- Редактирование клиента (`edit()`)
- Удаление клиента (`delete()`)
- Просмотр истории записей (`showHistory()`)
- Отображение деталей клиента с новыми полями

### 4. История записей

При нажатии на кнопку "История посещений":
- Открывается модальное окно с таблицей всех записей клиента
- Отображается:
  - Дата записи
  - Время
  - Специалист
  - Услуга
  - Длительность
  - Статус (с цветовым кодированием)
  - Сумма

## Миграция базы данных

Скрипт `scripts/migrate_clients.py` автоматически:
- Добавляет поле `telegram_id` в таблицу `clients`
- Добавляет поле `source` в таблицу `clients`

Миграция выполняется автоматически при запуске `app.py`.

## Использование

1. **Добавление клиента**:
   - Нажмите "Добавить клиента"
   - Заполните форму (обязательно: ФИО и Источник)
   - При необходимости укажите Telegram ID для входа через мини-приложение
   - Добавьте комментарий, если нужно
   - Нажмите "Сохранить клиента"

2. **Редактирование клиента**:
   - Выберите клиента из списка
   - Нажмите "Редактировать"
   - Измените нужные поля
   - Нажмите "Сохранить клиента"

3. **Просмотр истории записей**:
   - Выберите клиента из списка
   - Нажмите "История посещений"
   - Откроется модальное окно со всеми записями клиента

## Детали клиента

В боковой панели отображается:
- Фото клиента
- ФИО
- Телефон
- Email
- Дата регистрации
- Последнее посещение
- Всего записей
- Источник (если указан)
- Telegram ID (если указан)
- Комментарий (если есть)

## Дальнейшее развитие

- Интеграция с Telegram Bot API для автоматического создания клиентов
- Автоматическое заполнение Telegram ID при входе через мини-приложение
- Фильтрация клиентов по источнику
- Экспорт клиентов в Excel/CSV
- Массовые операции с клиентами

